(async function automateASKPortal() {
    function delay(ms) {
        return new Promise(res => setTimeout(res, ms));
    }
    function randomText(len = 6) {
        const chars = "abcdefghijklmnopqrstuvwxyz";
        return Array.from({ length: len }, () => chars[Math.floor(Math.random() * chars.length)]).join("");
    }
    function click(el) {
        if (!el) return;
        el.dispatchEvent(new MouseEvent("mousedown", { bubbles: true }));
        el.dispatchEvent(new MouseEvent("mouseup", { bubbles: true }));
        el.dispatchEvent(new MouseEvent("click", { bubbles: true }));
    }

    while (true) {
        try {
            // 1. Wait for search input
            let searchBox;
            while (!(searchBox = document.querySelector("input[placeholder*='How can I help']"))) {
                await delay(1000);
            }
            searchBox.value = randomText();
            searchBox.dispatchEvent(new Event("input", { bubbles: true }));
            console.log("‚å®Ô∏è Typed random text");
            await delay(7000);

            // 2. Find 3-line menu button INSIDE the same container as search bar
            let container = searchBox.closest("div, form, header");
            let threeLineBtn = container ? container.querySelector("button, [role='button']") : null;
            if (threeLineBtn) {
                click(threeLineBtn);
                console.log("‚ò∞ Clicked 3-line filter button");
            } else {
                console.warn("‚ö†Ô∏è Could not find 3-line button");
            }
            await delay(7000);

            // 3. Select India from Location dropdown/menu
            let indiaOption;
            while (!(indiaOption = [...document.querySelectorAll("option, div, li, button, span")]
                .find(el => /india/i.test(el.innerText || "")))) {
                await delay(1000);
            }
            click(indiaOption);
            console.log("üåç Selected India");
            await delay(7000);

            // 4. Click Search (magnifier button)
            let searchBtn;
            while (!(searchBtn = document.querySelector("button svg[viewBox*='magnifying']")?.closest("button"))) {
                await delay(1000);
            }
            click(searchBtn);
            console.log("üîç Clicked Search button");
            await delay(7000);

            // 5. Click first result
            let firstResult;
            while (!(firstResult = document.querySelector(".result-item, .list-item, a, h3"))) {
                await delay(1000);
            }
            click(firstResult);
            console.log("üìë Clicked first result");
            await delay(7000);

            // 6. Click ASK logo
            let askLogo;
            while (!(askLogo = [...document.querySelectorAll("a, span, img")]
                .find(el => /^\s*ASK\s*$/i.test(el.innerText || "") || /ask/i.test(el.getAttribute("alt") || "")))) {
                await delay(1000);
            }
            click(askLogo);
            console.log("üè† Clicked ASK logo");
            await delay(7000);

        } catch (err) {
            console.error("‚ö†Ô∏è Error:", err);
            await delay(7000);
        }
    }
})();
