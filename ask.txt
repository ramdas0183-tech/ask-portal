(async function() {
  // stop flag (set to true to stop)
  window.__ASK_AUTOMATION_STOP = window.__ASK_AUTOMATION_STOP || false;

  const delay = ms => new Promise(res => setTimeout(res, ms));

  function randomText(length = 6) {
    const chars = "abcdefghijklmnopqrstuvwxyz";
    return Array.from({length}, () => chars[Math.floor(Math.random() * chars.length)]).join("");
  }

  function isVisible(el) {
    if (!el || !el.getBoundingClientRect) return false;
    const r = el.getBoundingClientRect();
    return r.width > 2 && r.height > 2 && r.bottom > 0 && r.right > 0;
  }

  function clickEl(el) {
    if (!el) return;
    ["mouseover","mousedown","mouseup","click"].forEach(name =>
      el.dispatchEvent(new MouseEvent(name, { bubbles: true, cancelable: true, view: window }))
    );
  }

  async function waitFor(fn, desc) {
    // waits until fn() returns a truthy value; logs progress
    console.log(`⏳ waiting for ${desc}...`);
    while (!window.__ASK_AUTOMATION_STOP) {
      try {
        const v = fn();
        if (v) {
          console.log(`✅ found ${desc}`);
          return v;
        }
