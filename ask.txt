(async function automateASKPortal() {
    function delay(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    function randomText(length = 6) {
        const chars = "abcdefghijklmnopqrstuvwxyz";
        return Array.from({ length }, () => chars[Math.floor(Math.random() * chars.length)]).join("");
    }

    while (true) {
        try {
            // 1. Wait for search bar
            console.log("üîé Waiting for search bar...");
            let searchBox;
            while (!(searchBox = document.querySelector("input[placeholder*='How can I help']"))) {
                await delay(1000);
            }

            // Type random text
            searchBox.value = randomText();
            searchBox.dispatchEvent(new Event("input", { bubbles: true }));
            console.log("‚å®Ô∏è Typed random text.");
            await delay(7000);

            // 2. Click the 3-line filter button
            let filterBtn;
            while (!(filterBtn = document.querySelector("button[aria-label*='Filter'], button svg")?.closest("button"))) {
                await delay(1000);
            }
            filterBtn.click();
            console.log("‚öôÔ∏è Opened filter menu.");
            await delay(7000);

            // 3. Select Location = India
            let locationDropdown;
            while (!(locationDropdown = [...document.querySelectorAll("select")]
                .find(sel => [...sel.options].some(opt => opt.text.includes("India"))))) {
                await delay(1000);
            }

            let indiaOption = [...locationDropdown.options].find(opt => opt.text.includes("India"));
            if (indiaOption) {
                locationDropdown.value = indiaOption.value;
                locationDropdown.dispatchEvent(new Event("change", { bubbles: true }));
                console.log("üåç Location set to India.");
            }
            await delay(7000);

            // 4. Click the Search button (magnifying glass)
            let searchBtn;
            while (!(searchBtn = document.querySelector("button svg[viewBox*='magnifying']")?.closest("button"))) {
                await delay(1000);
            }
            searchBtn.click();
            console.log("üîç Clicked search.");
            await delay(7000);

            // 5. Click first search result
            let firstResult;
            while (!(firstResult = document.querySelector(".result-item, .list-item, a, h3"))) {
                await delay(1000);
            }
            firstResult.click();
            console.log("üìë Clicked first search result.");
            await delay(7000);

            // 6. Click ASK logo (top-left)
            let askLogo;
            while (!(askLogo = [...document.querySelectorAll("a, span, img")]
                .find(el => el.innerText?.trim() === "ASK" || el.getAttribute("alt") === "ASK"))) {
                await delay(1000);
            }
            askLogo.click();
            console.log("üè† Returned to ASK home.");
            await delay(7000);

        } catch (err) {
            console.error("‚ö†Ô∏è Error:", err);
            await delay(7000);
        }
    }
})();
